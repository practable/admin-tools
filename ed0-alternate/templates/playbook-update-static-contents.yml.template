---
- name: update static contents from git repo
  hosts: ${ANSIBLE_GROUP}
  become: yes
  gather_facts: no
  vars_files:
    - ../autogenerated/vars.yml
    
  tasks:
  
   - name: Create a directory for default index.html
     ansible.builtin.file:
       path: "/var/www/{{ domain }}/{{ instance_path }}"
       state: directory
       mode: '0755'
       
   - name: Create a directory for static files if it does not exist
     ansible.builtin.file:
       path: "/var/www/{{ domain }}/{{ instance_path }}/static"
       state: directory
       mode: '0755'
       
   - name: Create a directory for dev-static files if it does not exist
     ansible.builtin.file:
       path: "/var/www/{{ domain }}/{{ instance_path }}/dev-static"
       state: directory
       mode: '0755'   
     
   - name: Create a directory for git repos if it does not exist
     ansible.builtin.file:
       path: "/var/www/git"
       state: directory
       mode: '0755'

   - name: Git checkout static repo
     ansible.builtin.git:
       repo: "{{ static_repo_url }}"
       dest: "/var/www/git/{{ static_repo_name }}"

   - name: Create symbolic link for /{{ instance_path }}/index.html
     ansible.builtin.file:
       src:  "/var/www/git/{{ static_repo_name }}/index.html"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/index.html"
       state: link

   - name: Create symbolic link for /dev/static/index.html
     ansible.builtin.file:
       src:  "/var/www/git/{{ static_repo_name }}/index.html"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/static/index.html"
       state: link

   - name: Create symbolic links for static sub-directories
     ansible.builtin.file:
       src:  "/var/www/git/{{ static_repo_name }}/{{ item }}"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/static/{{ item }}"
       state: link
     loop: "{{ static_sub_dirs }}"

   - name: Create a symbolic link for book app
     ansible.builtin.file:
       src:  "/var/www/git/{{ static_repo_name }}/book"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/book"
       state: link

   - name: Create a symbolic link for status app
     ansible.builtin.file:
       src:  "/var/www/git/{{ static_repo_name }}/status"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/status"
       state: link

   - name: Git checkout dev-static repo
     ansible.builtin.git:
       repo: "{{ dev_static_repo_url }}"
       dest: "/var/www/git/{{ dev_static_repo_name }}"

   - name: Create a symbolic links for static sub-directories
     ansible.builtin.file:
       src:  "/var/www/git/{{ dev_static_repo_name }}/{{ item }}"
       dest: "/var/www/{{ domain }}/{{ instance_path }}/dev-static/{{ item }}"
       state: link
     loop: "{{ static_sub_dirs }}"



     

  

